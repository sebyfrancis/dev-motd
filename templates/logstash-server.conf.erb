# Config file for a Logstash server/indexer

input {

  <% @_redis_servers.each do |this_server| -%>
    redis {
      host      => "<%= this_server %>"
      data_type => "list"
      type      => "redis-input"
      key       => "<%= @_logstash_redis_key %>"
      threads   => "2"
      batch_count => "50"
    }
  <% end -%>
  
}

filter {

  if [type] == "trade" {
    grok {
      patterns_dir => "/etc/logstash/patterns"
      match        => [ "message", "%{GREEDYDATA}%{TRADE_CID:trade_cid}%{GREEDYDATA}" ]
    }
  }

}

output {

  elasticsearch { 
    cluster => "<%= @_es_cluster_name %>"
    host    => "<%= @_es_master_host %>"
    protocol => "transport"
  }

}
